name: ü§ñ Generate AI-Powered News Articles

on:
  workflow_dispatch: # Allows manual triggering from the GitHub Actions UI
  schedule:
    - cron: '0 */6 * * *' # Runs every 6 hours (at 00:00, 06:00, 12:00, 18:00 UTC)

jobs:
  generate_articles:
    runs-on: ubuntu-latest
    permissions:
      contents: write      # Required to commit changes to the repo
      pull-requests: write # Required to create pull requests

    steps:
      - name: ‚¨áÔ∏è Check out the repository
        uses: actions/checkout@v4

      - name: üü¢ Set up Node.js environment
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: üì¶ Install project dependencies
        run: npm install

      - name: ‚ú® Run article generation script
        id: generate
        run: node scripts/generate-articles.js
        env:
          # This secret must be configured in your GitHub repository settings
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

      - name: ü§ñ Create Pull Request with new articles
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "feat: ‚ú® Add new AI-generated articles"
          title: "ü§ñ New AI-Generated Articles for Review"
          body: |
            New articles have been automatically generated by the NEXORA system.

            Please review the changes, check for quality and accuracy, and merge if approved.

            **Manual Review Checklist:**
            - [ ] Review article content, title, and key takeaways for correctness.
            - [ ] Find, download, and add an appropriate cover image for each article.
            - [ ] Update the `image` path in the frontmatter.
            - [ ] Add relevant `tags` to the frontmatter.
            - [ ] Change `needs_review: true` to `needs_review: false`.
            - [ ] Merge the pull request to publish the articles.
          # This branch will be created automatically with the new articles
          branch: "feature/generated-articles"
          # Set your repository's default branch (e.g., main, master)
          base: "main"
          # Deletes the feature branch after the PR is merged
          delete-branch: true
          labels: |
            ai-generated
            needs-review
